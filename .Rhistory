install.packages("tidyverse")
install.packages("ggpubr")
install.packages("ggrepel")
install.packages("Rtools")
install.packages("tidyverse")
install.packages("ggpubr")
install.packages("ggrepel")
install.packages("Rtools")
installed.packages("Rtools")
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("clusterProfiler")
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("org.Hs.eg.db")
setwd("~/Project2")
# Load Req. Packages
library(readxl)
library(clusterProfiler)
library(clusterProfiler)
if (!require("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install(version = "3.21")
BiocManager::install(c("GenomicFeatures", "AnnotationDbi"))
BiocManager::valid()
BiocManager::install(c(
"BiocParallel", "igraph", "Rsamtools", "xml2"
), update = TRUE, ask = FALSE, force = TRUE)
setwd("~/Project2")
# load required packages
library(ggplot2)   # plotting
library(ggrepel)   # add text
# set working directory
setwd("~/Project2")
# load data from previous script
dge_results <- read.csv("R/DGE_results.csv")
### BASE
ggplot(dge_results,                 # plot data
aes(x = log2FoldChange,      # x axis
y = -log10(pvalue))) +   # y axis
### PLOT
geom_point()                        # add points
# create empty column for expression variable
dge_results$Expression <- NA
# in the expression column, add whether gene is ...
# ... up-regulated (log2FoldChange > 0)
dge_results$Expression[dge_results$log2FoldChange > 0] <- "up"
# ... or down-regulated (log2FoldChange < 0)
dge_results$Expression[dge_results$log2FoldChange < 0] <- "down"
### BASE
ggplot(dge_results,
aes(x = log2FoldChange,     # x axis
y = -log10(pvalue))) +  # y axis
### PLOT
geom_point(aes(color = Expression))  # points with colors
# genes cited in article
up_genes <- c("CXCL5", "CXCL12", "CCL2", "CCL4", "CXCL10",
"IFIH1", "IFI44", "IFIT1", "IL6", "IL10")
down_genes <- c("RPL41", "RPL17", "SLC25A6", "CALM1", "TUBA1A")
# create its own data frame
volcano_labels <- subset(dge_results, Gene %in% c(up_genes, down_genes))
### BASE
ggplot(dge_results,
aes(x = log2FoldChange,        # x axis
y = -log10(pvalue))) +     # y axis
### PLOT
geom_point(aes(color = Expression)) +  # points with colors
geom_text_repel(data = volcano_labels, # source data
color = "black",       # black text
aes(x = log2FoldChange,
y = -log10(pvalue),
label = Gene))     # label mapping
### BASE
ggplot(dge_results,
aes(x = log2FoldChange,
y = -log10(pvalue))) +
### PLOT
geom_point(aes(color = Expression)) +
geom_text_repel(data = volcano_labels,
color = "black",           # black text labels
aes(x = log2FoldChange,
y = -log10(pvalue),
label = Gene)) +        # label mapping
geom_point(data = volcano_labels,           # source data
shape = 1,                       # hollow black circles
color = "black",
aes(x = log2FoldChange,          # same x axis
y = -log10(pvalue)))         # same y axis
### BASE
ggplot(dge_results,
aes(x = log2FoldChange,
y = -log10(pvalue))) +
### PLOT
geom_point(aes(color = Expression)) +
geom_text_repel(data = volcano_labels,
color = "black",
aes(x = log2FoldChange,
y = -log10(pvalue),
label = Gene)) +
geom_point(data = volcano_labels,
shape = 1, color = "black",
aes(x = log2FoldChange,
y = -log10(pvalue))) +
geom_vline(xintercept = c(-1, 1), linetype = "dashed") +  # vertical dashed lines
geom_hline(yintercept = 0, linetype = "dashed")           # horizontal dashed line
### BASE
volcano.plot <-
ggplot(dge_results,
aes(x = log2FoldChange,
y = -log10(pvalue))) +
### PLOT
geom_point(aes(color = Expression)) +
geom_text_repel(data = volcano_labels,
color = "black",
aes(x = log2FoldChange,
y = -log10(pvalue),
label = Gene)) +
geom_point(data = volcano_labels,
shape = 1, color = "black",
aes(x = log2FoldChange,
y = -log10(pvalue))) +
geom_vline(xintercept = c(-1, 1), linetype = "dashed") +
geom_hline(yintercept = 0, linetype = "dashed") +
### MODS
scale_color_manual(values = c("blue", "red")) +   # change to blue & red
theme_classic() +                                # remove grid lines
theme(panel.border = element_rect(color = "grey", fill = NA),  # add grey border
legend.position = "none") +                # remove legend
labs(title = "Volcano plot representing upregulated and downregulated genes",
subtitle = "Victoria Dixon")                # add title and your name
### view
volcano.plot
### save
ggsave("PLOTS/volcano.pdf", volcano.plot, device = "pdf",
width = 6, height = 8, units = "in")
setwd("~/Project2")
# load required packages
library(ggplot2)
library(ggpubr)
# set working directory
setwd("~/Project2")
# load data from previous script
dge_results <- read.csv("R/DGE_results.csv")
pathways <- read.csv("R/DGE_pathways.csv")
# pathways shown in plot
up_paths <- c("Cytokine-cytokine receptor interaction", "JAK-STAT signaling pathway",
"Complement and coagulation cascades", "Hematopoietic cell lineage",
"Chemokine signaling pathway", "Inflammatory bowel disease",
"Toll-like receptor signaling pathway", "IL-17 signaling pathway",
"TGF-beta signaling pathway", "Th1 and Th2 cell differentiation")
down_paths <- c("Ribosome", "Oxidative phosphorylation", "Viral myocarditis",
"Protein processing in endoplasmic reticulum", "Oxytocin signaling pathway",
"Type I diabetes mellitus", "Phagosome", "Amyotrophic lateral sclerosis",
"Ferroptosis", "Allograft rejection")
# subset by those pathways
pathways <- subset(pathways, Pathway %in% c(up_paths, down_paths))
# combine with DGE results
pathways <- merge(pathways, dge_results, by = "Gene")
# create empty columns for number of genes per pathway ...
pathways$NumGenes <- NA
# ... and the mean adjusted p value per pathway
pathways$pMean <- NA
for (path in c(up_paths, down_paths)) {                  # loop through pathway names
df <- subset(pathways, Pathway == path)                # subset pathway data by pathway name
n <- length(df$Gene)                                   # get number of genes in that pathway
p <- mean(df$padj)                                     # calculate mean adjusted p value
pathways$NumGenes[pathways$Pathway == path] <- n       # add number of genes to column
pathways$pMean[pathways$Pathway == path] <- p          # add mean p value to column
}
# subset to up/down regulated pathways
pathways <- unique(pathways[c("Pathway", "NumGenes", "pMean")])
up_pathways <- subset(pathways, Pathway %in% up_paths)
down_pathways <- subset(pathways, Pathway %in% down_paths)
# base plot for up-regulated pathways
ggplot(up_pathways,
aes(x = NumGenes,             # x-axis: number of genes
y = Pathway,              # y-axis: pathway name
color = pMean,            # color mapped to mean adjusted p-value
size = NumGenes)) +       # size mapped to number of genes
geom_point()
# y axis is ordered by number of genes
up_order <- up_pathways$Pathway[order(up_pathways$NumGenes)]
### BASE
ggplot(up_pathways, aes(x = NumGenes, y = Pathway)) +
### PLOT
geom_point(aes(color = pMean, size = NumGenes)) +
scale_y_discrete(limits = up_order)  # order y axis
### BASE
up.plot <-
ggplot(up_pathways, aes(x = NumGenes, y = Pathway)) +
### PLOT
geom_point(aes(color = pMean, size = NumGenes)) +
### MODS
scale_color_gradient(low = "blue", high = "red",
limits = c(min(pathways$pMean), max(pathways$pMean))) +   # shared color scale
scale_size_continuous(limits = c(min(pathways$NumGenes), max(pathways$NumGenes))) +  # shared size scale
theme_light() +                                                               # clean theme
theme(axis.title = element_blank()) +                                         # remove axis titles
labs(color = "Mean\nadjusted\np-value", size = "Number\nof genes")            # customize legend titles
### BASE
up.plot <-
ggplot(up_pathways, aes(x = NumGenes, y = Pathway)) +
### PLOT
geom_point(aes(color = pMean, size = NumGenes)) +
### MODS
scale_color_gradient(low = "blue", high = "red",
limits = c(min(pathways$pMean), max(pathways$pMean))) +   # shared color scale
scale_size_continuous(limits = c(min(pathways$NumGenes), max(pathways$NumGenes))) +  # shared size scale
theme_light() +                                                               # clean theme
theme(axis.title = element_blank()) +                                         # remove axis titles
labs(color = "Mean\nadjusted\np-value", size = "Number\nof genes")            # customize legend titles
### BASE
up.plot <-
ggplot(up_pathways, aes(x = NumGenes, y = Pathway)) +
### PLOT
geom_point(aes(color = pMean, size = NumGenes)) +
### MODS
scale_color_gradient(low = "blue", high = "red",
limits = c(min(pathways$pMean), max(pathways$pMean))) +   # shared color scale
scale_size_continuous(limits = c(min(pathways$NumGenes), max(pathways$NumGenes))) +  # shared size scale
theme_light() +                                                               # clean theme
theme(axis.title = element_blank()) +                                         # remove axis titles
labs(color = "Mean\nadjusted\np-value", size = "Number\nof genes")            # customize legend titles
### BASE
up.plot <-
ggplot(up_pathways, aes(x = NumGenes, y = Pathway)) +
### PLOT
geom_point(aes(color = pMean, size = NumGenes)) +
### MODS
scale_color_gradient(low = "blue", high = "red",
limits = c(min(pathways$pMean), max(pathways$pMean))) +   # shared color scale
scale_size_continuous(limits = c(min(pathways$NumGenes), max(pathways$NumGenes))) +  # shared size scale
theme_light() +                                                               # clean theme
theme(axis.title = element_blank()) +                                         # remove axis titles
labs(color = "Mean\nadjusted\np-value", size = "Number\nof genes")            # customize legend titles
# y axis is ordered by number of genes
down_order <- down_pathways$Pathway[order(down_pathways$NumGenes)]
### BASE
down.plot <-
ggplot(down_pathways, aes(x = NumGenes, y = Pathway)) +
### PLOT
geom_point(aes(color = pMean, size = NumGenes)) +
scale_y_discrete(limits = down_order, position = "right") +  # move y-axis to the right
scale_x_reverse() +                                          # reverse x-axis
scale_color_gradient(low = "blue", high = "red",
limits = c(min(pathways$pMean), max(pathways$pMean))) +
scale_size_continuous(limits = c(min(pathways$NumGenes), max(pathways$NumGenes))) +
theme_light() +
theme(axis.title = element_blank()) +
labs(color = "Mean\nadjusted\np-value", size = "Number\nof genes")
# arrange both plots
dot.plot <-
ggarrange(up.plot, down.plot,         # one on top of the other
ncol = 1,                   # single column layout
common.legend = TRUE,       # share a legend
legend = "right",           # position legend on the right
bgcolor = "white")          # background color
up.plot <-
ggplot(up_pathways, aes(x = NumGenes, y = Pathway)) +
geom_point(aes(color = pMean, size = NumGenes)) +
scale_color_gradient(low = "blue", high = "red",
limits = c(min(pathways$pMean, na.rm = TRUE),
max(pathways$pMean, na.rm = TRUE))) +
scale_size_continuous(limits = c(min(pathways$NumGenes, na.rm = TRUE),
max(pathways$NumGenes, na.rm = TRUE))) +
theme_light() +
theme(axis.title = element_blank()) +
labs(color = "Mean\nadjusted\np-value",
size  = "Number\nof genes")
# show plot in RStudio
print(up.plot)
down_order <- down_pathways$Pathway[order(down_pathways$NumGenes)]
down.plot <-
ggplot(down_pathways, aes(x = NumGenes, y = Pathway)) +
geom_point(aes(color = pMean, size = NumGenes)) +
scale_y_discrete(limits = down_order, position = "right") +
scale_x_reverse() +
scale_color_gradient(low = "blue", high = "red",
limits = c(min(pathways$pMean, na.rm = TRUE),
max(pathways$pMean, na.rm = TRUE))) +
scale_size_continuous(limits = c(min(pathways$NumGenes, na.rm = TRUE),
max(pathways$NumGenes, na.rm = TRUE))) +
theme_light() +
theme(axis.title = element_blank()) +
labs(color = "Mean\nadjusted\np-value",
size  = "Number\nof genes")
# show plot in RStudio
print(down.plot)
library(ggpubr)  # ensure loaded for ggarrange()
dot.plot <-
ggarrange(up.plot, down.plot,
ncol = 1,              # stack vertically
common.legend = TRUE,  # shared legend
legend = "right",      # legend on right
bgcolor = "white")     # white background
# display the combined figure
print(dot.plot)
# export to PDF
ggsave("PLOTS/dot.pdf", dot.plot,
width = 6, height = 10, units = "in")
# order y axis by number of genes
down_order <- down_pathways$Pathway[order(down_pathways$NumGenes)]
### BASE
down.plot <-
ggplot(down_pathways, aes(x = NumGenes, y = Pathway)) +
### PLOT
geom_point(aes(color = pMean, size = NumGenes)) +
scale_y_discrete(limits = down_order, position = "right") +  # ordered y-axis on the right
scale_x_reverse() +                                          # reverse x-axis
scale_color_gradient(low = "blue", high = "red",
limits = c(min(pathways$pMean, na.rm = TRUE),
max(pathways$pMean, na.rm = TRUE))) +
scale_size_continuous(limits = c(min(pathways$NumGenes, na.rm = TRUE),
max(pathways$NumGenes, na.rm = TRUE))) +
theme_light() +
theme(axis.title = element_blank()) +
labs(color = "Mean\nadjusted\np-value",
size  = "Number\nof genes")
# display the plot
print(down.plot)
# order y-axis by number of genes (largest at top)
up_order <- up_pathways$Pathway[order(up_pathways$NumGenes)]
up.plot <-
ggplot(up_pathways, aes(x = NumGenes, y = Pathway)) +
geom_point(aes(color = pMean, size = NumGenes)) +
scale_y_discrete(limits = up_order) +                        # reorder by NumGenes
scale_color_gradient(low = "blue", high = "red",
limits = c(min(pathways$pMean, na.rm = TRUE),
max(pathways$pMean, na.rm = TRUE))) +
scale_size_continuous(limits = c(min(pathways$NumGenes, na.rm = TRUE),
max(pathways$NumGenes, na.rm = TRUE))) +
theme_light() +
theme(axis.title = element_blank()) +
labs(color = "Mean\nadjusted\np-value",
size  = "Number\nof genes")
# show the plot
print(up.plot)
# order y axis by number of genes
down_order <- down_pathways$Pathway[order(down_pathways$NumGenes)]
### BASE
down.plot <-
ggplot(down_pathways, aes(x = NumGenes, y = Pathway)) +
### PLOT
geom_point(aes(color = pMean, size = NumGenes)) +
scale_y_discrete(limits = down_order, position = "right") +  # ordered y-axis on the right
scale_x_reverse() +                                          # reverse x-axis
scale_color_gradient(low = "blue", high = "red",
limits = c(min(pathways$pMean, na.rm = TRUE),
max(pathways$pMean, na.rm = TRUE))) +
scale_size_continuous(limits = c(min(pathways$NumGenes, na.rm = TRUE),
max(pathways$NumGenes, na.rm = TRUE))) +
theme_light() +
theme(axis.title = element_blank()) +
labs(color = "Mean\nadjusted\np-value",
size  = "Number\nof genes")
# display the plot
print(down.plot)
library(ggpubr)  # ensure loaded for ggarrange()
dot.plot <-
ggarrange(up.plot, down.plot,
ncol = 1,              # stack vertically
common.legend = TRUE,  # shared legend
legend = "right",      # legend on right
bgcolor = "white")     # white background
# display the combined figure
print(dot.plot)
# export to PDF
ggsave("PLOTS/dot.pdf", dot.plot,
width = 6, height = 10, units = "in")
# export to PDF
ggsave("PLOTS/dot.pdf", dot.plot,
width = 6, height = 10, units = "in")
source("~/COVID-19 Patient Transcriptomics/CODE/03_dot_plot.R")
